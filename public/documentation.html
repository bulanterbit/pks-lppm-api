<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PKS-LPPM API Documentation</title>
    <link rel="stylesheet" href="./css/documentation.css" />
</head>

<body>
    <nav>
        <h2>üìò Dokumentasi</h2>
        <ul>
            <li><a href="#overview">1. Overview</a></li>
            <li><a href="#setup">2. Setup & Konfigurasi</a></li>
            <li><a href="#auth">3. Autentikasi</a></li>
            <li><a href="#models">4. Struktur Database</a></li>
            <li><a href="#schema">5. Struktur JSON PKS</a></li>
            <li><a href="#routes">6. Endpoint API</a></li>
            <li><a href="#generator">7. Generate Dokumen PKS</a></li>
            <li><a href="#error">8. Error Handling</a></li>
            <li><a href="#security">9. Keamanan</a></li>
            <li><a href="#arch">10. Arsitektur Proyek</a></li>
        </ul>
    </nav>

    <main>
        <section id="overview">
            <h1>üìò PKS-LPPM API Documentation</h1>
            <p>API resmi untuk pengelolaan <strong>Perjanjian Kerja Sama (PKS)</strong> LPPM UPN ‚ÄúVeteran‚Äù Yogyakarta.
                Framework: <code>Node.js + Express</code>, database <code>MongoDB</code>, dokumen dibuat otomatis dengan
                pustaka <code>docx</code>.</p>
        </section>

        <section id="setup">
            <h2>2. Setup & Konfigurasi</h2>
            <pre><code># Instalasi
npm install

# File .env.development
PORT=5000
MONGO_URI=mongodb://localhost:27017/pksdb
JWT_SECRET=secretkey
BASE_URL=http://localhost:5000

# Jalankan server
npm run dev</code></pre>
            <p>Dapat diakses melalui <code>http://localhost:5000/api</code></p>
        </section>

        <section id="auth">
            <h2>3. Autentikasi</h2>
            <p>Sistem hanya memiliki satu entitas pengguna, yaitu <strong>Admin</strong>.
                Admin login melalui email & password, mendapatkan token JWT untuk otorisasi endpoint lainnya.</p>

            <h3>Endpoint Autentikasi</h3>
            <table>
                <tr>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Akses</th>
                    <th>Deskripsi</th>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/auth/register</td>
                    <td>Public</td>
                    <td>Daftarkan admin baru (hanya digunakan saat setup awal)</td>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/auth/login</td>
                    <td>Public</td>
                    <td>Login admin dan dapatkan JWT token</td>
                </tr>
                <tr>
                    <td>GET</td>
                    <td>/api/auth/me</td>
                    <td>Admin</td>
                    <td>Ambil data admin yang sedang login</td>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/auth/logout</td>
                    <td>Admin</td>
                    <td>Logout dan hapus sesi aktif</td>
                </tr>
                <tr>
                    <td>PATCH</td>
                    <td>/api/auth/change-password</td>
                    <td>Admin</td>
                    <td>Ganti password akun admin</td>
                </tr>
            </table>
        </section>

        <section id="models">
            <h2>4. Struktur Database</h2>
            <h3>Admin Model</h3>
            <table>
                <tr>
                    <th>Field</th>
                    <th>Tipe</th>
                    <th>Deskripsi</th>
                </tr>
                <tr>
                    <td>username</td>
                    <td>String</td>
                    <td>Nama login unik (minimal 3 karakter)</td>
                </tr>
                <tr>
                    <td>email</td>
                    <td>String</td>
                    <td>Email unik (disimpan lowercase)</td>
                </tr>
                <tr>
                    <td>password</td>
                    <td>String</td>
                    <td>Password terenkripsi (bcrypt hash)</td>
                </tr>
                <tr>
                    <td>nama</td>
                    <td>String</td>
                    <td>Nama lengkap admin</td>
                </tr>
                <tr>
                    <td>isActive</td>
                    <td>Boolean</td>
                    <td>Status akun (default: true)</td>
                </tr>
                <tr>
                    <td>createdAt</td>
                    <td>Date</td>
                    <td>Tanggal dibuat otomatis</td>
                </tr>
                <tr>
                    <td>updatedAt</td>
                    <td>Date</td>
                    <td>Tanggal terakhir diubah otomatis</td>
                </tr>
            </table>

            <h3>PKS Model</h3>
            <table>
                <tr>
                    <th>Bagian</th>
                    <th>Field</th>
                    <th>Tipe</th>
                    <th>Deskripsi</th>
                </tr>
                <tr>
                    <td rowspan="4">content</td>
                    <td>nomor</td>
                    <td>String</td>
                    <td>Nomor PKS unik</td>
                </tr>
                <tr>
                    <td>judul</td>
                    <td>String</td>
                    <td>Judul perjanjian</td>
                </tr>
                <tr>
                    <td>tanggal</td>
                    <td>Date</td>
                    <td>Tanggal penandatanganan</td>
                </tr>
                <tr>
                    <td>tanggalKadaluarsa</td>
                    <td>Date</td>
                    <td>Tanggal berakhir PKS</td>
                </tr>
                <tr>
                    <td rowspan="6">pihakKedua</td>
                    <td>instansi</td>
                    <td>String</td>
                    <td>Nama lembaga mitra</td>
                </tr>
                <tr>
                    <td>nama</td>
                    <td>String</td>
                    <td>Nama penandatangan</td>
                </tr>
                <tr>
                    <td>jabatan</td>
                    <td>String</td>
                    <td>Jabatan pihak kedua</td>
                </tr>
                <tr>
                    <td>alamat</td>
                    <td>String</td>
                    <td>Alamat instansi</td>
                </tr>
                <tr>
                    <td>nomor</td>
                    <td>String</td>
                    <td>Nomor telepon</td>
                </tr>
                <tr>
                    <td>email</td>
                    <td>String</td>
                    <td>Email kontak</td>
                </tr>
            </table>
        </section>

        <section id="schema">
            <h2>5. Struktur JSON PKS</h2>
            <pre><code>{
  "content": {
    "judul": "Kerja Sama Pengembangan Riset",
    "tanggal": "2025-10-07T00:00:00Z",
    "tanggalKadaluarsa": "2026-10-07T00:00:00Z"
  },
  "pihakKedua": {
    "instansi": "Universitas Gadjah Mada",
    "nama": "Prof. Dr. Andi Wijaya",
    "jabatan": "Rektor",
    "alamat": "Jl. Kaliurang No. 1, Sleman, Yogyakarta",
    "email": "andi.wijaya@ugm.ac.id"
  }
}</code></pre>
        </section>

        <section id="routes">
            <h2>6. Endpoint API Lengkap</h2>

            <h3>üìÑ PKS Routes</h3>
            <table>
                <tr>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Akses</th>
                    <th>Controller</th>
                    <th>Deskripsi</th>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/pks</td>
                    <td>Public</td>
                    <td>createPKS</td>
                    <td>Ajukan PKS baru</td>
                </tr>
                <tr>
                    <td>GET</td>
                    <td>/api/pks</td>
                    <td>Public</td>
                    <td>getAllPKS</td>
                    <td>Ambil semua PKS</td>
                </tr>
                <tr>
                    <td>GET</td>
                    <td>/api/pks/:nomor</td>
                    <td>Public</td>
                    <td>getPKSByNomor</td>
                    <td>Ambil detail PKS berdasarkan nomor</td>
                </tr>
                <tr>
                    <td>PATCH</td>
                    <td>/api/pks/:nomor</td>
                    <td>Admin</td>
                    <td>updatePKSByNomor</td>
                    <td>Ubah data PKS berdasarkan nomor</td>
                </tr>
                <tr>
                    <td>DELETE</td>
                    <td>/api/pks/:nomor</td>
                    <td>Admin</td>
                    <td>deletePKSByNomor</td>
                    <td>Hapus PKS berdasarkan nomor</td>
                </tr>
                <tr>
                    <td>GET</td>
                    <td>/api/pks/id/:id</td>
                    <td>Admin</td>
                    <td>getPKSById</td>
                    <td>Ambil detail PKS berdasarkan ObjectId</td>
                </tr>
                <tr>
                    <td>PATCH</td>
                    <td>/api/pks/id/:id</td>
                    <td>Admin</td>
                    <td>updatePKS</td>
                    <td>Ubah data PKS berdasarkan ObjectId</td>
                </tr>
                <tr>
                    <td>DELETE</td>
                    <td>/api/pks/id/:id</td>
                    <td>Admin</td>
                    <td>deletePKS</td>
                    <td>Hapus PKS berdasarkan ObjectId</td>
                </tr>
            </table>

            <h3>üìÇ File & Dokumen Routes</h3>
            <table>
                <tr>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Akses</th>
                    <th>Controller</th>
                    <th>Deskripsi</th>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/pks/:nomor/file</td>
                    <td>Public</td>
                    <td>uploadFile</td>
                    <td>Upload dokumen/lampiran PKS</td>
                </tr>
                <tr>
                    <td>GET</td>
                    <td>/api/pks/:nomor/file</td>
                    <td>Public</td>
                    <td>downloadFile</td>
                    <td>Unduh file PKS</td>
                </tr>
                <tr>
                    <td>DELETE</td>
                    <td>/api/pks/:nomor/file</td>
                    <td>Admin</td>
                    <td>deleteFile</td>
                    <td>Hapus file PKS</td>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/pks/:nomor/generate</td>
                    <td>Admin</td>
                    <td>generatePKSDocument</td>
                    <td>Generate dokumen resmi PKS (.docx)</td>
                </tr>
            </table>

            <h3>üîê Autentikasi Routes</h3>
            <table>
                <tr>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Akses</th>
                    <th>Controller</th>
                    <th>Deskripsi</th>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/auth/register</td>
                    <td>Public</td>
                    <td>register</td>
                    <td>Registrasi admin</td>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/auth/login</td>
                    <td>Public</td>
                    <td>login</td>
                    <td>Login admin</td>
                </tr>
                <tr>
                    <td>GET</td>
                    <td>/api/auth/me</td>
                    <td>Admin</td>
                    <td>getMe</td>
                    <td>Data admin login</td>
                </tr>
                <tr>
                    <td>POST</td>
                    <td>/api/auth/logout</td>
                    <td>Admin</td>
                    <td>logout</td>
                    <td>Logout</td>
                </tr>
                <tr>
                    <td>PATCH</td>
                    <td>/api/auth/change-password</td>
                    <td>Admin</td>
                    <td>changePassword</td>
                    <td>Ganti password admin</td>
                </tr>
            </table>
        </section>

        <section id="generator">
            <h2>7. Generate Dokumen PKS</h2>
            <p><code>documentGenerator.service.js</code> membentuk file <strong>.docx</strong> berdasarkan data dari
                model PKS.</p>
            <pre><code>POST /api/pks/:nomor/generate</code></pre>
            <p><strong>Response:</strong></p>
            <pre><code>{
  "success": true,
  "message": "Dokumen PKS berhasil dibuat",
  "path": "/file/generated/pks_2025_001.docx"
}</code></pre>
        </section>

        <section id="error">
            <h2>8. Error Handling</h2>
            <table>
                <tr>
                    <th>Kode</th>
                    <th>Pesan</th>
                    <th>Deskripsi</th>
                </tr>
                <tr>
                    <td>400</td>
                    <td>Validation Error</td>
                    <td>Input tidak valid</td>
                </tr>
                <tr>
                    <td>401</td>
                    <td>Unauthorized</td>
                    <td>Token tidak valid</td>
                </tr>
                <tr>
                    <td>403</td>
                    <td>Forbidden</td>
                    <td>Akses ditolak (bukan admin)</td>
                </tr>
                <tr>
                    <td>404</td>
                    <td>Not Found</td>
                    <td>Data tidak ditemukan</td>
                </tr>
                <tr>
                    <td>500</td>
                    <td>Server Error</td>
                    <td>Kesalahan server</td>
                </tr>
            </table>
        </section>

        <section id="security">
            <h2>9. Keamanan</h2>
            <ul>
                <li>Gunakan HTTPS untuk produksi.</li>
                <li>Token JWT dikirim via header Authorization.</li>
                <li>Rate limiter aktif pada endpoint login & register.</li>
                <li>CORS diatur hanya untuk domain resmi frontend.</li>
            </ul>
        </section>

        <section id="arch">
            <h2>10. Arsitektur Proyek</h2>
            <pre><code>server.js
 ‚îú‚îÄ‚îÄ routes/
 ‚îÇ    ‚îú‚îÄ‚îÄ auth.routes.js ‚Üí Auth Controller ‚Üí Admin Model
 ‚îÇ    ‚îî‚îÄ‚îÄ pks.routes.js  ‚Üí PKS Controller  ‚Üí PKS Model
 ‚îú‚îÄ‚îÄ controllers/
 ‚îÇ    ‚îú‚îÄ‚îÄ auth.controller.js
 ‚îÇ    ‚îú‚îÄ‚îÄ pks.controller.js
 ‚îÇ    ‚îú‚îÄ‚îÄ document.controller.js
 ‚îÇ    ‚îî‚îÄ‚îÄ file.controller.js
 ‚îú‚îÄ‚îÄ services/documentGenerator.service.js
 ‚îú‚îÄ‚îÄ middleware/
 ‚îÇ    ‚îú‚îÄ‚îÄ auth.middleware.js
 ‚îÇ    ‚îú‚îÄ‚îÄ upload.middleware.js
 ‚îÇ    ‚îú‚îÄ‚îÄ validation.middleware.js
 ‚îÇ    ‚îî‚îÄ‚îÄ rateLimiter.middleware.js
 ‚îî‚îÄ‚îÄ public/
      ‚îú‚îÄ‚îÄ documentation.html
      ‚îú‚îÄ‚îÄ upload_test.html
      ‚îú‚îÄ‚îÄ css/
      ‚îî‚îÄ‚îÄ js/
</code></pre>
        </section>
    </main>
</body>

</html>